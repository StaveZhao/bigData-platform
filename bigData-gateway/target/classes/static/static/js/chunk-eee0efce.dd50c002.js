(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eee0efce"],{"1bfd":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chart-container"},[a("div",{staticClass:"widget-left-container"},[a("div",{staticClass:"widget-left-header"},[a("span",[t._v("数据集")]),a("el-dropdown",{staticStyle:{float:"right",color:"#499df3"},attrs:{trigger:"click"},on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[t._v(" 切换"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dataSetOptions,(function(e){return a("el-dropdown-item",{key:e.id,attrs:{command:e.id}},[t._v(t._s(e.setName))])})),1)],1)],1),a("div",{staticClass:"widget-left-field"},[t._m(0),a("draggable",{staticClass:"widget-left-field-draggable",attrs:{options:{sort:!1,ghostClass:"ghost",group:{name:"dimensions",pull:!0,put:!1}}},model:{value:t.dimensions,callback:function(e){t.dimensions=e},expression:"dimensions"}},t._l(t.dimensions,(function(e,i){return a("el-tag",{key:i,staticClass:"draggable-label"},[a("div",[t._v(t._s(e.alias?e.alias+"("+e.col+")":e.col))])])})),1)],1),a("div",{staticClass:"widget-left-field"},[t._m(1),a("draggable",{staticClass:"widget-left-field-draggable",attrs:{options:{sort:!1,ghostClass:"ghost",group:{name:"measures",pull:!0,put:!1}}},model:{value:t.measures,callback:function(e){t.measures=e},expression:"measures"}},t._l(t.measures,(function(e,i){return a("el-tag",{key:i,staticClass:"draggable-label"},[a("div",[t._v(t._s(e.alias?e.alias+"("+e.col+")":e.col))])])})),1)],1)]),a("div",{staticClass:"widget-center-container"},[a("div",{staticClass:"widget-center-header"},[a("div",{staticClass:"widget-center-header-collapse",on:{click:t.handleCollapse}},[a("i",{staticClass:"el-icon-d-arrow-right",class:{"is-active":t.isCollapse}})]),a("div",{staticClass:"widget-center-header-button"},[a("el-button",{attrs:{icon:"el-icon-view",type:"text"},on:{click:t.handlePreview}},[t._v(" 预览 ")]),a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:t.handleReset}},[t._v(" 重置 ")]),a("el-button",{directives:[{name:"hasPerm",rawName:"v-hasPerm",value:["visual:chart:build"],expression:"['visual:chart:build']"}],attrs:{icon:"el-icon-plus",type:"text"},on:{click:t.handleSubmit}},[t._v(" 保存 ")]),a("el-button",{attrs:{icon:"el-icon-close",type:"text"},on:{click:t.handleCancel}},[t._v(" 取消 ")])],1)]),a("div",{staticClass:"widget-center-content"},[a("div",{staticClass:"widget-center-draggable-wrapper"},[a("el-divider",{attrs:{"content-position":"left"}},[t._v("行维")]),a("div",{staticClass:"widget-center-draggable-text"},[a("draggable",{staticClass:"widget-center-draggable-line",attrs:{group:"dimensions",list:t.widget.rows}},t._l(t.widget.rows,(function(e,i){return a("el-tag",{key:i,staticClass:"draggable-item",attrs:{closable:""},on:{close:function(a){return t.handleKeyTagClose(i,e)}}},[t._v(" "+t._s(e.alias?e.alias+"("+e.col+")":e.col)+" ")])})),1)],1),a("el-divider",{attrs:{"content-position":"left"}},[t._v("列维")]),a("div",{staticClass:"widget-center-draggable-text"},[a("draggable",{staticClass:"widget-center-draggable-line",attrs:{group:"dimensions",list:t.widget.columns}},t._l(t.widget.columns,(function(e,i){return a("el-tag",{key:i,staticClass:"draggable-item",attrs:{closable:""},on:{close:function(a){return t.handleGroupTagClose(i,e)}}},[t._v(" "+t._s(e.alias?e.alias+"("+e.col+")":e.col)+" ")])})),1)],1),a("el-divider",{attrs:{"content-position":"left"}},[t._v("指标")]),a("div",{staticClass:"widget-center-draggable-text"},[a("draggable",{staticClass:"widget-center-draggable-line",attrs:{group:"measures",list:t.widget.measures},on:{change:t.handleValueDragChange}},t._l(t.widget.measures,(function(e,i){return a("div",{key:i,staticClass:"draggable-item"},[a("el-tag",[t._v(t._s(e.alias?e.aggregateType+"("+e.col+") -> "+e.alias:e.aggregateType+"("+e.col+")"))]),a("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[a("el-radio-group",{attrs:{size:"mini"},model:{value:e.aggregateType,callback:function(a){t.$set(e,"aggregateType",a)},expression:"item.aggregateType"}},[a("el-radio",{attrs:{label:"sum",size:"mini"}},[t._v("求和")]),a("el-radio",{attrs:{label:"count",size:"mini"}},[t._v("计数")]),a("el-radio",{attrs:{label:"avg",size:"mini"}},[t._v("平均值")]),a("el-radio",{attrs:{label:"max",size:"mini"}},[t._v("最大值")]),a("el-radio",{attrs:{label:"min",size:"mini"}},[t._v("最小值")])],1),a("span",{staticClass:"draggable-item-handle",attrs:{slot:"reference"},slot:"reference"},[a("i",{staticClass:"el-icon-edit-outline"})])],1),a("span",{staticClass:"draggable-item-handle",on:{click:function(a){return t.handleValueTagClose(i,e)}}},[a("i",{staticClass:"el-icon-delete"})])],1)})),0)],1)],1),a("div",{staticClass:"widget-center-pane"},[a("el-tabs",{attrs:{type:"card"}},[a("el-tab-pane",{attrs:{label:"图表预览"}},[a("div",{staticClass:"widget-center-pane-chart"},[t.visible?a("chart-panel",{ref:"chartPanel",attrs:{id:"chartPanel","chart-schema":t.widget,"chart-data":t.chartData.data}}):t._e()],1)]),a("el-tab-pane",{attrs:{label:"查询脚本"}},[a("div",{staticClass:"widget-center-pane-script"},[t._v(t._s(t.chartData.sql))])])],1)],1)])]),a("div",{staticClass:"widget-right-container",class:{hideRightContainer:t.isCollapse}},[a("el-tabs",{staticClass:"widget-right-tab",attrs:{type:"border-card",stretch:""}},[a("el-tab-pane",{attrs:{label:"图表属性"}},[a("div",{staticClass:"widget-right-pane-form"},[a("el-form",{attrs:{size:"mini","label-position":"top"}},[a("el-form-item",{attrs:{label:"图表名称"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.dataChart.chartName,callback:function(e){t.$set(t.dataChart,"chartName",e)},expression:"dataChart.chartName"}})],1),a("el-form-item",{attrs:{label:"缩略图"}},[a("el-upload",{class:{hideUpload:t.hideUpload},attrs:{action:"#",accept:".png, .jpg, .jpeg","list-type":"picture-card",limit:1,"auto-upload":!1,"before-upload":t.beforeUpload,"on-change":t.handleChange,"on-remove":t.handleRemove,"file-list":t.fileList}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),a("el-form-item",{attrs:{label:"图表类型"}},[a("div",{staticClass:"chart-type-list"},t._l(t.chartTypes,(function(e){return a("span",{key:e.value,class:e.value===t.widget.chartType?"active":"",on:{click:function(a){e.status&&e.rule.check(t.widget.rows,t.widget.columns,t.widget.measures)&&t.changeChart(e.value)}}},[a("el-tooltip",{attrs:{content:e.name+":"+e.rule.text,placement:"top"}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":e.icon+(e.status&&e.rule.check(t.widget.rows,t.widget.columns,t.widget.measures)?"_active":"")}})],1)],1)})),0)])],1)],1)]),a("el-tab-pane",{attrs:{label:"图表配置"}},[a("div",{staticClass:"widget-right-pane-config"},[a("el-collapse",{attrs:{accordion:""},model:{value:t.collapsActiveNames,callback:function(e){t.collapsActiveNames=e},expression:"collapsActiveNames"}},[a("el-collapse-item",{attrs:{title:"图表主题",name:"1"}},[a("el-form",{attrs:{size:"mini"}},[a("el-form-item",[a("el-select",{model:{value:t.widget.theme,callback:function(e){t.$set(t.widget,"theme",e)},expression:"widget.theme"}},t._l(t.chartThemes,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:t}})})),1)],1)],1)],1),a("el-collapse-item",{attrs:{title:"标题组件",name:"2"}},[a("el-form",{attrs:{size:"mini"}},[a("el-form-item",{attrs:{label:"是否显示"}},[a("el-switch",{attrs:{"active-text":"开启"},model:{value:t.widget.options.title.show,callback:function(e){t.$set(t.widget.options.title,"show",e)},expression:"widget.options.title.show"}})],1),a("el-form-item",{attrs:{label:"主标题文本"}},[a("el-input",{model:{value:t.widget.options.title.text,callback:function(e){t.$set(t.widget.options.title,"text",e)},expression:"widget.options.title.text"}})],1),a("el-form-item",{attrs:{label:"副标题文本"}},[a("el-input",{model:{value:t.widget.options.title.subtext,callback:function(e){t.$set(t.widget.options.title,"subtext",e)},expression:"widget.options.title.subtext"}})],1),a("el-form-item",{attrs:{label:"离左侧的距离"}},[a("el-slider",{on:{change:function(e){t.widget.options.title.left=t.widget.options.title.leftVal+"%"}},model:{value:t.widget.options.title.leftVal,callback:function(e){t.$set(t.widget.options.title,"leftVal",e)},expression:"widget.options.title.leftVal"}})],1),a("el-form-item",{attrs:{label:"离上侧的距离"}},[a("el-slider",{on:{change:function(e){t.widget.options.title.top=t.widget.options.title.topVal+"%"}},model:{value:t.widget.options.title.topVal,callback:function(e){t.$set(t.widget.options.title,"topVal",e)},expression:"widget.options.title.topVal"}})],1),a("el-form-item",{attrs:{label:"主标题字体大小"}},[a("el-input-number",{attrs:{min:1,max:30},model:{value:t.widget.options.title.textStyle.fontSize,callback:function(e){t.$set(t.widget.options.title.textStyle,"fontSize",e)},expression:"widget.options.title.textStyle.fontSize"}})],1),a("el-form-item",{attrs:{label:"主标题文字的颜色"}},[a("el-color-picker",{model:{value:t.widget.options.title.textStyle.color,callback:function(e){t.$set(t.widget.options.title.textStyle,"color",e)},expression:"widget.options.title.textStyle.color"}})],1),a("el-form-item",{attrs:{label:"副标题字体大小"}},[a("el-input-number",{attrs:{min:1,max:20},model:{value:t.widget.options.title.subtextStyle.fontSize,callback:function(e){t.$set(t.widget.options.title.subtextStyle,"fontSize",e)},expression:"widget.options.title.subtextStyle.fontSize"}})],1),a("el-form-item",{attrs:{label:"副标题文字的颜色"}},[a("el-color-picker",{model:{value:t.widget.options.title.subtextStyle.color,callback:function(e){t.$set(t.widget.options.title.subtextStyle,"color",e)},expression:"widget.options.title.subtextStyle.color"}})],1)],1)],1),a("el-collapse-item",{attrs:{title:"图例组件",name:"3"}},[a("el-form",{attrs:{size:"mini"}},[a("el-form-item",{attrs:{label:"是否显示"}},[a("el-switch",{attrs:{"active-text":"开启"},model:{value:t.widget.options.legend.show,callback:function(e){t.$set(t.widget.options.legend,"show",e)},expression:"widget.options.legend.show"}})],1),a("el-form-item",{attrs:{label:"图例的类型"}},[a("el-select",{model:{value:t.widget.options.legend.type,callback:function(e){t.$set(t.widget.options.legend,"type",e)},expression:"widget.options.legend.type"}},[a("el-option",{attrs:{label:"普通图例",value:"plain"}}),a("el-option",{attrs:{label:"可滚动翻页的图例",value:"scroll"}})],1)],1),a("el-form-item",{attrs:{label:"离左侧的距离"}},[a("el-slider",{on:{change:function(e){t.widget.options.legend.left=t.widget.options.legend.leftVal+"%"}},model:{value:t.widget.options.legend.leftVal,callback:function(e){t.$set(t.widget.options.legend,"leftVal",e)},expression:"widget.options.legend.leftVal"}})],1),a("el-form-item",{attrs:{label:"离上侧的距离"}},[a("el-slider",{on:{change:function(e){t.widget.options.legend.top=t.widget.options.legend.topVal+"%"}},model:{value:t.widget.options.legend.topVal,callback:function(e){t.$set(t.widget.options.legend,"topVal",e)},expression:"widget.options.legend.topVal"}})],1),a("el-form-item",{attrs:{label:"列表的布局朝向"}},[a("el-select",{model:{value:t.widget.options.legend.orient,callback:function(e){t.$set(t.widget.options.legend,"orient",e)},expression:"widget.options.legend.orient"}},[a("el-option",{attrs:{label:"横向",value:"horizontal"}}),a("el-option",{attrs:{label:"纵向",value:"vertical"}})],1)],1)],1)],1),a("el-collapse-item",{attrs:{title:"数据系列",name:"4"}},[a("el-form",{attrs:{size:"mini"}},[a("el-form-item",[a("el-select",{model:{value:t.widget.seriesType,callback:function(e){t.$set(t.widget,"seriesType",e)},expression:"widget.seriesType"}},t._l(t.chartSeriesTypes[t.widget.chartType],(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.value}})})),1)],1)],1)],1)],1)],1)])],1)],1)])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"widget-left-field-cate"},[a("i",{staticClass:"icon iconfont icon-weidu"}),a("span",[t._v("维度列")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"widget-left-field-cate"},[a("i",{staticClass:"icon iconfont icon-zhibiao"}),a("span",[t._v("指标列")])])}],l=a("2909"),n=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("4de4"),a("99af"),a("a434"),a("e9c4"),a("1dc5")),o=a("2e65"),r=a("b76a"),c=a.n(r),d=a("2780"),u=a("3a5b"),g=a("5d62"),p={name:"DataChartBuild",components:{draggable:c.a,ChartPanel:u["default"]},data:function(){return{dataChart:{},widget:{dataSetId:void 0,chartType:"table",rows:[],columns:[],measures:[],filters:[],options:d["b"],theme:"default",seriesType:void 0},dataSetOptions:[],dataSet:{},dimensions:[],measures:[],chartTypes:d["e"],chartThemes:d["d"],chartSeriesTypes:d["c"],chartData:{data:[],sql:""},visible:!1,isCollapse:!1,collapsActiveNames:"1",fileList:[],hideUpload:!1}},created:function(){this.getDataChart(this.$route.params.id),this.getDataSetList()},methods:{getDataChart:function(t){var e=this;Object(n["f"])(t).then((function(t){if(t.success){if(e.dataChart=t.data,e.dataChart.chartThumbnail){var a=Object(g["b"])(e.dataChart.chartThumbnail),i=URL.createObjectURL(a);e.fileList.push({url:i}),e.hideUpload=!0}if(e.dataChart.chartConfig){var s=JSON.parse(e.dataChart.chartConfig);Object(o["c"])(s.dataSetId).then((function(t){t.success&&(e.dataSet=t.data,e.dimensions=e.dataSet.schemaConfig.dimensions.filter((function(t){return[].concat(Object(l["a"])(s.rows),Object(l["a"])(s.columns)).every((function(e){return e.col!==t.col}))})),e.measures=e.dataSet.schemaConfig.measures.filter((function(t){return s.measures.every((function(e){return e.col!==t.col}))})))})),e.widget.dataSetId=s.dataSetId,e.widget.chartType=s.chartType,e.widget.rows=s.rows||[],e.widget.columns=s.columns||[],e.widget.measures=s.measures||[]}}}))},getDataSetList:function(){var t=this;Object(o["d"])().then((function(e){e.success&&(t.dataSetOptions=e.data)}))},handleCommand:function(t){var e=this;Object(o["c"])(t).then((function(t){t.success&&(e.dataSet=t.data,e.widget.dataSetId=e.dataSet.id,e.handleReset())}))},handleKeyTagClose:function(t,e){this.widget.rows.splice(t,1),this.dimensions.push(e)},handleGroupTagClose:function(t,e){this.widget.columns.splice(t,1),this.dimensions.push(e)},handleValueDragChange:function(t){t.added&&this.$set(t.added.element,"aggregateType","sum")},handleValueTagClose:function(t,e){this.widget.measures.splice(t,1),e.aggregateType="",this.measures.push(e)},handleCollapse:function(){this.isCollapse=!this.isCollapse},handlePreview:function(){var t=this;Object(n["d"])(this.widget).then((function(e){if(e.success){var a=e.data;t.chartData.data=a.data,t.chartData.sql=a.sql,t.visible=!0}}))},handleReset:function(){this.dimensions=JSON.parse(JSON.stringify(this.dataSet.schemaConfig.dimensions)),this.measures=JSON.parse(JSON.stringify(this.dataSet.schemaConfig.measures)),this.widget.chartType="table",this.widget.rows=[],this.widget.columns=[],this.widget.measures=[],this.chartData.data=[],this.chartData.sql="",this.visible=!1},handleSubmit:function(){var t=this,e={id:this.dataChart.id,chartThumbnail:this.dataChart.chartThumbnail,chartConfig:JSON.stringify(this.widget)};Object(n["b"])(e).then((function(e){e.success&&t.$message.success("保存成功")}))},handleCancel:function(){window.location.href="about:blank",window.close()},changeChart:function(t){this.widget.chartType=t,this.widget.seriesType=((this.chartSeriesTypes[this.widget.chartType]||[])[0]||{}).value||void 0},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("上传图片大小不能超过 2MB"),e},handleChange:function(t,e){var a=this;this.hideUpload=e.length>=1;var i={width:250,height:150,quality:.8};Object(g["a"])(t.raw,i).then((function(t){a.$set(a.dataChart,"chartThumbnail",t)}))},handleRemove:function(t,e){this.hideUpload=e.length>=1,this.$set(this.dataChart,"chartThumbnail","x")}}},h=p,m=(a("eb48"),a("2877")),f=Object(m["a"])(h,i,s,!1,null,"4621df16",null);e["default"]=f.exports},"2e65":function(t,e,a){"use strict";a.d(e,"d",(function(){return s})),a.d(e,"e",(function(){return l})),a.d(e,"c",(function(){return n})),a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return r})),a.d(e,"g",(function(){return c})),a.d(e,"f",(function(){return d}));var i=a("b775");function s(t){return Object(i["a"])({url:"/data/visual/dataSets/list",method:"get",params:t})}function l(t){return Object(i["a"])({url:"/data/visual/dataSets/page",method:"get",params:t})}function n(t){return Object(i["a"])({url:"/data/visual/dataSets/"+t,method:"get"})}function o(t){return Object(i["a"])({url:"/data/visual/dataSets/"+t,method:"delete"})}function r(t){return Object(i["a"])({url:"/data/visual/dataSets",method:"post",data:t})}function c(t){return Object(i["a"])({url:"/data/visual/dataSets/"+t.id,method:"put",data:t})}function d(t){return Object(i["a"])({url:"/data/visual/dataSets/sql/analyse",method:"post",data:t})}},"5d62":function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return s}));a("d3b7"),a("ac1f"),a("1276"),a("466d"),a("ace4"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7");function i(t,e){var a=new FileReader;return a.readAsDataURL(t),new Promise((function(i,s){a.onload=function(a){var s=new Image;s.src=a.target.result,s.onload=function(){var a,s=e.width,l=e.height,n=document.createElement("canvas"),o=n.getContext("2d");n.setAttribute("width",s),n.setAttribute("height",l),o.drawImage(this,0,0,s,l),a=n.toDataURL(t["type"],e.quality),i(a)}}}))}function s(t){var e=t.split(","),a=e[0].match(/:(.*?);/)[1],i=atob(e[1]),s=i.length,l=new Uint8Array(s);while(s--)l[s]=i.charCodeAt(s);return new Blob([l],{type:a})}},"90df":function(t,e,a){},eb48:function(t,e,a){"use strict";a("90df")}}]);